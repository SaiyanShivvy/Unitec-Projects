<!doctype html>
<!-- TODO: Move Inline Script functions to external seats.js -->
<!-- TODO: other boat layout -->
<!-- TODO: redo functions so it can easily work for both tables, not just one -->
<!-- TODO: create a total cost calc function, may need jQuery -->
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Assignment 2 - Test 3</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <script type="text/javascript" src="seats.js"></script> -->
  <link rel="stylesheet" type="text/css" href="mStyle.css">
</head>

<body>
  <script>
    var seatRose = [];
    var seatPrincess = [];

    function seat(id, row, isBooked, price) {
      this.id = id;
      this.row = row;
      this.isBooked = isBooked;
      this.price = price;
    }

    window.onload = function getRows() {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open("get", "rose.xml", true);
      xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          createRoseSeat(this);
        }
      };
      xmlhttp.send(null);
    }

    function createRoseSeat(xmlhttp) {
      var xmlDoc = xmlhttp.responseXML.documentElement;
      var x = xmlDoc.getElementsByTagName("seat");

      var sID = '';
      var sRow = '';
      var sBook = '';
      var sPrice = '';
      for (i = 0; i < x.length; i++) {
        sID = x[i].getElementsByTagName("id")[0].childNodes[0].nodeValue;
        sRow = x[i].getElementsByTagName("row")[0].childNodes[0].nodeValue;
        sBook = x[i].getElementsByTagName("isBooked")[0].childNodes[0].nodeValue;
        sPrice = x[i].getElementsByTagName("price")[0].childNodes[0].nodeValue;
        //console.log(sID, sRow, sBook, sPrice);

        var newSeat = new seat(sID, sRow, sBook, sPrice);
        seatRose[i] = newSeat;
      }
    }

    function selectRoseSeat(cell) {
      // - [x] TODO: Add or Remove Seat from Cart
      // - [ ] TODO: Calculate Total

      var cart = document.getElementById('selected-seats');
      var liCart = document.createElement("li");
      var rmCart;
      if (cell.classList.contains("booked")) {
        alert("Sorry, bud. You were to slow and this seat " + cell.id + " is now booked.")
      } else if (cell.classList.contains('selected')) {
        cell.classList.toggle("selected");
        rmCart = document.getElementById("cart-item-" + cell.id);
        rmCart.parentNode.removeChild(rmCart);
        //console.log(cell);
      } else {
        cell.classList.toggle("selected");
        liCart.setAttribute("id", "cart-item-" + cell.id)
        liCart.appendChild(document.createTextNode("Seat " + cell.id));
        cart.append(liCart);
        roseDetails(cell);
        //console.log(cell);
      }
    }

    function roseDetails(cell) {
      // - [ ] TODO: When Seat is selected display the booking details from the array.
      var seatInfo = document.getElementById('seatInfo');
      var seatPrice = document.getElementById('seatPrice');
      var total = document.getElementById('total');
      if (cell.classList.contains("selected")) {
        seatInfo.textContent = cell.id;
        seatPrice.textContent = "$" + getRoseSeatPrice(cell.id);
      } else {
        seatInfo.textContent = " ";
        seatPrice.textContent = " ";
        $(".hello").empty();
      }
    }

    function getRoseSeatPrice(id) {
      //console.log(id);
      for (var i = 0; i < seatRose.length; i++) {
        if (seatRose[i].id == id) {
          var sP = seatRose[i].price;
          //console.log(sP);
          return sP;
        }
      }
    }

    function display_rose() {
      var table = document.getElementById('roseLayout');
      var numRows = 9;
      var numCol = 9;
      var sNum = 0;
      for (var i = 0; i < numRows; i++) {
        var row = table.insertRow(i);
        for (var j = 0; j < numCol; j++) {
          //cellName = seatRose[sNum].id + "_" + seatRose[sNum].row;
          cellName = seatRose[sNum].id
          //console.log(cellName);
          cell = row.insertCell(row.cells.length);
          if (seatRose[sNum].id == 'M' || seatRose[sNum].id == 'W') {
            cell.innerHTML = '<div>' + '</div>';
            cell.setAttribute("class", "walk");
            //console.log("Cell:" + seatRose[sNum].id);
          } else {
            if (seatRose[sNum].isBooked == "yes") {
              cell.innerHTML = '<div>' + seatRose[sNum].id + '</div>';
              cell.setAttribute("class", "seat booked");
            } else {
              cell.innerHTML = '<div>' + seatRose[sNum].id + '</div>';
              cell.setAttribute("class", "seat");
            }
            cell.setAttribute("id", cellName);
            cell.setAttribute("onclick", "selectRoseSeat(this)");
            row.appendChild(cell);
          }
          sNum = sNum + 1;
        }
      }
      table.appendChild(row);
    }
  </script>

  <div id="navbar">
    <ul>
      <li>
        <a href="index.html">Seat Booking</a>
      </li>
      <li>
        <a href="game.html">Game</a>
      </li>
      <li>
        <a href="index.html">Part 3</a>
      </li>
    </ul>
  </div>

  <h1>Rose Layout</h1>
  <div class="wrapper">
    <div class="container">
      <button type="button" onclick="display_rose()">Show Rose Layout</button>
      <table border='1' id="roseLayout"></table>

      <div class="booking-details">
        <h2>Booking Details</h2>
        <h4>Time:
          <!-- <input id="datetime" type="datetime-local"> -->
          <select id="DateTime">
            <option value="date1">18 May 2017 - 10:30 AM</option>
            <option value="date2" selected>18 May 2017 - 12:30 PM</option>
            <option value="date3">18 May 2017 - 2:30 PM</option>
          </select>
        </h4>
        <h4>Seat:
          <span id="seatInfo"></span>
        </h4>
        <h4>Price:
          <span id="seatPrice"></span>
        </h4>
        <h3> Selected Seats:
          <span id="counter"></span>
        </h3>
        <ul id="selected-seats"></ul>
        Total:
        <b>$
          <span id="total">0</span>
        </b>
      </div>
    </div>
  </div>
</body>

</html>